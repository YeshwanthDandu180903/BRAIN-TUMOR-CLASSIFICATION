<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Brain Tumor Classifier</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

    <style>
        body { transition: background 0.4s ease, color 0.4s ease; }
        .dark-mode { background:#111; color:#fff !important; }
        .navbar-dark { background:#222 !important; }
        .navbar-light { background:#f8f9fa !important; }

        .upload-box {
            border:2px dashed #007bff;
            padding:40px;
            border-radius:15px;
            text-align:center;
            background: rgba(255,255,255,0.9);
            cursor:pointer;
        }
        .dark-mode .upload-box { background:rgba(30,30,30,0.9); border-color:#66b2ff; }
        .upload-box.dragover { background:#e9f5ff; }
        .dark-mode .upload-box.dragover { background:#1a2733; }

        .example-img {
            width:100%;
            max-width:500px;
            border-radius:10px;
            box-shadow:0px 6px 15px rgba(0,0,0,0.2);
        }
        #loadingSpinner { display:none; }
    </style>
</head>

<body class="bg-light" id="themeBody">

<nav class="navbar navbar-light px-4 py-3 shadow-sm" id="themeNavbar">
    <span class="navbar-brand">
        <i class="fas fa-brain text-primary"></i> <b>Brain Tumor Classifier</b>
    </span>
    <span onclick="toggleTheme()">
        <i class="fas fa-moon fa-lg" id="themeIcon"></i>
    </span>
</nav>

<div class="container py-5">

    <!-- Intro section (only when no result) -->
    {% if not result %}
    <div class="text-center mb-4">
        <h2>ðŸ§  Brain Tumor Classification</h2>
        <p class="text-muted">
            Upload an MRI scan â€” the model detects <b>Glioma</b>, <b>Meningioma</b>, <b>Pituitary</b>, or <b>No Tumor</b>.
        </p>
    </div>
    {% endif %}

    <!-- UPLOAD AREA -->
    <div class="upload-box shadow mb-4" id="dropArea">
        <p><i class="fas fa-cloud-upload-alt fa-2x text-primary"></i></p>
        <p class="fw-bold">Drag & Drop MRI Image Here</p>
        <p class="text-muted">or click to select a file</p>

        <form method="POST" enctype="multipart/form-data" id="uploadForm">
            <input type="file" name="file" id="fileInput" class="form-control mt-3">

            <div class="form-check mt-3">
                <input class="form-check-input" type="checkbox" value="on" id="generatePdf" name="generate_pdf">
                <label class="form-check-label" for="generatePdf">
                    Generate PDF medical report
                </label>
            </div>

            <div id="loadingSpinner" class="mt-3">
                <div class="spinner-border text-primary"></div>
                <p>Analyzing MRIâ€¦ Please wait</p>
            </div>

            <button id="predictBtn" class="btn btn-primary mt-3">Predict</button>
        </form>
    </div>

    <!-- IMAGE PREVIEW -->
    {% if image_url %}
    <div class="text-center mb-4">
        <img src="{{ image_url }}" class="img-fluid rounded shadow" style="max-height:350px;">
    </div>
    {% endif %}

    <!-- RESULT -->
    {% if result %}
    <div class="card p-4 shadow mb-5">

        <h2 class="text-center text-primary">{{ result.label }}</h2>
        <p class="text-center">Confidence: <b>{{ result.confidence }}</b></p>

        <hr>

        <h4>Disease Details</h4>
        <p><b>Description:</b> {{ result.description }}</p>
        <p><b>Cause:</b> {{ result.cause }}</p>

        <p><b>Symptoms:</b></p>
        <ul>
            {% for s in result.symptoms %}
            <li>{{ s }}</li>
            {% endfor %}
        </ul>

        <p><b>Treatment:</b> {{ result.treatment }}</p>

        {% if result.example_url %}
        <h5 class="mt-4">Example Image</h5>
        <img src="{{ result.example_url }}" class="example-img">
        {% endif %}

        {% if pdf_url %}
        <div class="text-center mt-4">
            <a class="btn btn-success" href="{{ pdf_url }}" download>
                Download Medical Report (PDF)
            </a>
        </div>
        {% endif %}
    </div>
    {% endif %}

</div>

<script>
function toggleTheme() {
    const body = document.getElementById("themeBody");
    const nav = document.getElementById("themeNavbar");
    const icon = document.getElementById("themeIcon");

    body.classList.toggle("dark-mode");
    if (body.classList.contains("dark-mode")) {
        nav.classList.replace("navbar-light","navbar-dark");
        icon.classList.replace("fa-moon","fa-sun");
    } else {
        nav.classList.replace("navbar-dark","navbar-light");
        icon.classList.replace("fa-sun","fa-moon");
    }
}

const dropArea = document.getElementById("dropArea");
const fileInput = document.getElementById("fileInput");

dropArea.addEventListener("dragover", (e)=>{ e.preventDefault(); dropArea.classList.add("dragover"); });
dropArea.addEventListener("dragleave", ()=> dropArea.classList.remove("dragover"));
dropArea.addEventListener("drop",(e)=>{
    e.preventDefault();
    dropArea.classList.remove("dragover");
    if (e.dataTransfer.files.length > 0) fileInput.files = e.dataTransfer.files;
});
dropArea.addEventListener("click",(e)=>{
    if (e.target.id !== "predictBtn") fileInput.click();
});

document.getElementById("predictBtn").addEventListener("click", (e)=> e.stopPropagation());
document.getElementById("uploadForm").addEventListener("click",(e)=> e.stopPropagation());

document.getElementById("uploadForm").addEventListener("submit",()=>{
    document.getElementById("predictBtn").style.display="none";
    document.getElementById("loadingSpinner").style.display="block";
});
</script>

</body>
</html>
